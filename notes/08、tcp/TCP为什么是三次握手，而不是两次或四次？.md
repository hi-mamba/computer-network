

#  TCP 为什么是三次握手，而不是两次或四次？

这个问题在谢希仁版《计算机网络》里说了。

三次是保证双方互相明确对方能收能发的最低值。

理论上讲不论握手多少次都不能确认一条信道是“可靠”的，但通过3次握手可以至少确认它是“可用”的，
再往上加握手次数不过是提高“它是可用的”这个结论的可信程度。


通俗的说吧，
第一次握手就是a发送一个建立连接的请求给b，
第二次是b确认收到a发的这个请求，
第三次是a发出确认收到b的回包。
三次握手是为了保障双方都能收到对方的包，
就像我上面说的，如果两次握手的话，b是不知道自己给a发的包a能不能收到。


### [原文](https://www.zhihu.com/question/24853633)



## 【问题1】为什么连接的时候是三次握手，关闭的时候却是四次握手？ 

答：因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。
其中ACK报文是用来应答的，SYN报文是用来同步的。  
  但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，
所以只能先回复一个ACK报文，告诉Client端，”你发的FIN报文我收到了”。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，
因此不能一起发送。故需要四步握手


## 【问题2】为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？ 
答：虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，
有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。

MSL就是maximum segment lifetime(最大分节生命期），这是一个IP数据包能在互联网上生存的最长时间，
超过这个时间IP数据包将在网络中消失 。
MSL在RFC 1122上建议是2分钟，而源自berkeley的TCP实现传统上使用30秒。

这种2MSL等待的另一个结果是这个TCP连接在2MSL等待期间，定义这个连接的插口对（包括本地以及远端的IP地址和端口号）不能再被使用。 
特别是对于服务器，因为服务器使用熟知的端口，如果终止一个服务器程序，并试图立即重启这个服务器程序，
服务器程序将不能把它的这个熟知端口赋值给它的端点，因为这个端口是处于2MSL连接的一部分。
 
 